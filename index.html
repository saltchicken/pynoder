<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/litegraph.css">
	<script type="text/javascript" src="js/litegraph.js"></script>
  <script type="text/javascript" src="js/nodes.js"></script>
  <script type="text/javascript" src="js/utils.js"></script>
</head>
<body style='width:100%; height:100%'>
<button id="runbutton"></button>
<button id="savebutton"></button>
<button id="loadbutton"></button>
<button id="loadFromFileButton"></button>
<button id="saveToFileButton"></button>
<script>

function resizeCanvas() {
    let canvas = document.getElementById("mycanvas");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    if (canvas.graphcanvas) {
        canvas.graphcanvas.resize(); // Ensure LiteGraph updates its size
    }
}
var graph = createGraph();
resizeCanvas();

function createGraph(){
  const canvasElement = document.createElement("canvas");
  canvasElement.id = "mycanvas";
  canvasElement.width = 1024;
  canvasElement.height = 720;
  canvasElement.style.border = "1px solid";
  document.body.appendChild(canvasElement);
  var graph = new LGraph();
  var canvas = new LGraphCanvas("#mycanvas", graph);
  return graph;
}

var button = document.getElementById("runbutton");
button.innerHTML = "Send Graph Data";
button.addEventListener("click", sendGraphData);


// var node_const = LiteGraph.createNode("basic/const");
// node_const.pos = [200,200];
// graph.add(node_const);
// node_const.setValue(4.5);
//
// var node_watch = LiteGraph.createNode("basic/watch");
// node_watch.pos = [700,200];
// graph.add(node_watch);
//
// node_const.connect(0, node_watch, 0 );
loadGraph();
// graph.start();

    async function sendGraphData() {
        const jsonData = graph.serialize();
        console.log("Sending graph data:", jsonData);

        let response = await fetch('/process_graph', {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(jsonData)
        });

        let result = await response.json();
        console.log("Server Response:", result);
    }
function saveGraph() {
    const data = graph.serialize();
    localStorage.setItem("myGraph", JSON.stringify(data)); // Save to local storage or send to a server
    console.log("Graph saved:", data);
}

function loadGraph() {
    const data = localStorage.getItem("myGraph");
    if (data) {
        graph.configure(JSON.parse(data));
        console.log("Graph loaded:", data);
    } else {
        console.log("No saved graph found.");
    }
    graph.start();
}

function loadGraphFromFile() {
  graph.load();
}

function saveGraphToFile() {
  graph.save();
}


var savebutton = document.getElementById("savebutton");
savebutton.innerHTML = "Save Graph";
savebutton.addEventListener("click", saveGraph);

var loadbutton = document.getElementById("loadbutton");
loadbutton.innerHTML = "Load Graph";
loadbutton.addEventListener("click", loadGraph);

var loadFromFileButton = document.getElementById("loadFromFileButton");
loadFromFileButton.innerHTML = "Load Graph From File";
loadFromFileButton.addEventListener("click", loadGraphFromFile);

var saveToFileButton = document.getElementById("saveToFileButton");
saveToFileButton.innerHTML = "Save Graph To File";
saveToFileButton.addEventListener("click", saveGraphToFile);

</script>
</body>
</html>
